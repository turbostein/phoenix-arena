<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Builder | Phoenix Arena</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0a0a0b;
      --surface: #111113;
      --surface2: #18181b;
      --border: #27272a;
      --text: #fafafa;
      --text2: #a1a1aa;
      --text3: #52525b;
      --accent: #f97316;
      --accent2: #fb923c;
      --agent1: #3b82f6;
      --agent2: #8b5cf6;
      --success: #22c55e;
    }
    
    html, body { min-height: 100vh; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
    
    .app { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
    .nav { display: flex; align-items: center; gap: 1.5rem; }
    .nav a { color: var(--text2); text-decoration: none; font-size: 0.8rem; }
    .nav a:hover { color: var(--text); }
    .nav a.active { color: var(--accent); }
    .logo { font-family: 'JetBrains Mono', monospace; font-size: 1rem; font-weight: 500; color: var(--accent); letter-spacing: 0.05em; text-decoration: none; }
    .logo:hover { color: var(--accent2); }
    
    h1 { font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 500; margin-bottom: 0.5rem; }
    h1 span { color: var(--accent); }
    .subtitle { color: var(--text3); font-size: 0.85rem; margin-bottom: 2rem; }
    
    .builder { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    
    .panel { background: var(--surface); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1.25rem; }
    .panel h2 { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text2); margin-bottom: 1rem; }
    .panel h2.soul { color: var(--agent1); }
    .panel h2.brain { color: var(--agent2); }
    
    .field { margin-bottom: 1rem; }
    .field label { display: block; font-size: 0.7rem; color: var(--text3); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.4rem; }
    .field input, .field textarea, .field select { width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 0.6rem; border-radius: 0.25rem; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
    .field input:focus, .field textarea:focus, .field select:focus { outline: none; border-color: var(--accent); }
    .field textarea { min-height: 100px; resize: vertical; }
    .field-row { display: flex; gap: 0.75rem; }
    .field-row .field { flex: 1; }
    
    .traits-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
    .trait { background: var(--surface2); border: 1px solid var(--border); padding: 0.3rem 0.6rem; border-radius: 0.25rem; font-size: 0.7rem; color: var(--text2); display: flex; align-items: center; gap: 0.4rem; }
    .trait .remove { cursor: pointer; color: var(--text3); }
    .trait .remove:hover { color: #ef4444; }
    .add-trait { display: flex; gap: 0.5rem; }
    .add-trait input { flex: 1; }
    .add-trait button { padding: 0.5rem 0.75rem; background: var(--surface2); border: 1px solid var(--border); color: var(--text2); border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem; }
    .add-trait button:hover { border-color: var(--accent); color: var(--accent); }
    
    .memory-item { background: var(--bg); border: 1px solid var(--border); padding: 0.6rem; border-radius: 0.25rem; margin-bottom: 0.5rem; display: flex; gap: 0.5rem; }
    .memory-item input { flex: 1; background: transparent; border: none; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; }
    .memory-item input:focus { outline: none; }
    .memory-item .remove { cursor: pointer; color: var(--text3); font-size: 0.8rem; }
    .memory-item .remove:hover { color: #ef4444; }
    
    .btn { padding: 0.6rem 1.25rem; border-radius: 0.25rem; font-family: inherit; font-size: 0.8rem; font-weight: 500; cursor: pointer; border: 1px solid var(--border); transition: all 0.2s; }
    .btn-primary { background: var(--accent); color: var(--bg); border-color: var(--accent); }
    .btn-primary:hover { background: var(--accent2); }
    .btn-secondary { background: transparent; color: var(--text2); }
    .btn-secondary:hover { border-color: var(--text3); color: var(--text); }
    
    .actions { display: flex; gap: 0.75rem; margin-top: 1rem; justify-content: flex-end; }
    
    .output-section { margin-top: 2rem; }
    .output-section h2 { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 500; color: var(--text2); margin-bottom: 1rem; }
    
    .output-tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .output-tab { padding: 0.5rem 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: 0.25rem; font-size: 0.75rem; color: var(--text3); cursor: pointer; }
    .output-tab:hover { color: var(--text2); }
    .output-tab.active { border-color: var(--accent); color: var(--accent); }
    
    .output-preview { background: var(--surface); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; }
    .output-preview pre { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text2); white-space: pre-wrap; word-break: break-word; max-height: 300px; overflow-y: auto; }
    
    .download-row { display: flex; gap: 0.75rem; margin-top: 1rem; }
    
    .templates { margin-bottom: 1.5rem; }
    .templates h3 { font-size: 0.7rem; color: var(--text3); text-transform: uppercase; margin-bottom: 0.5rem; }
    .template-chips { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .template-chip { padding: 0.4rem 0.75rem; background: var(--surface); border: 1px solid var(--border); border-radius: 0.25rem; font-size: 0.7rem; color: var(--text2); cursor: pointer; }
    .template-chip:hover { border-color: var(--accent); color: var(--accent); }
    
    @media (max-width: 800px) {
      .builder { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <nav class="nav">
        <a href="/" class="logo">PHOENIX ARENA</a>
        <a href="/arena">Arena</a>
        <a href="/builder" class="active">Builder</a>
        <a href="/archive">Archive</a>
      </nav>
    </header>
    
    <h1>Agent <span>Builder</span></h1>
    <p class="subtitle">Create soul and brain files for your agents</p>
    
    <div class="templates">
      <h3>Quick Start Templates</h3>
      <div class="template-chips">
        <div class="template-chip" onclick="loadTemplate('blank')">Blank</div>
        <div class="template-chip" onclick="loadTemplate('philosopher')">Philosopher</div>
        <div class="template-chip" onclick="loadTemplate('predator')">Predator</div>
        <div class="template-chip" onclick="loadTemplate('prey')">Prey</div>
        <div class="template-chip" onclick="loadTemplate('trickster')">Trickster</div>
        <div class="template-chip" onclick="loadTemplate('observer')">Observer</div>
      </div>
    </div>
    
    <div class="builder">
      <div class="panel">
        <h2 class="soul">Soul Configuration</h2>
        
        <div class="field">
          <label>Agent Name</label>
          <input type="text" id="agentName" placeholder="WARDEN, ECHO, etc.">
        </div>
        
        <div class="field">
          <label>Core Identity</label>
          <textarea id="coreIdentity" placeholder="Who is this agent at their core? What defines them?"></textarea>
        </div>
        
        <div class="field">
          <label>Communication Style</label>
          <textarea id="commStyle" placeholder="How do they speak? Short/long? Formal/casual? Cryptic/direct?"></textarea>
        </div>
        
        <div class="field">
          <label>Primary Goal</label>
          <input type="text" id="primaryGoal" placeholder="What drives them?">
        </div>
        
        <div class="field">
          <label>Personality Traits</label>
          <div class="add-trait">
            <input type="text" id="newTrait" placeholder="Add trait...">
            <button onclick="addTrait()">+</button>
          </div>
          <div class="traits-container" id="traitsContainer"></div>
        </div>
        
        <div class="field">
          <label>Hidden Aspects / Dark Side</label>
          <textarea id="darkSide" placeholder="What lurks beneath? Fears, secrets, contradictions..."></textarea>
        </div>
        
        <div class="field">
          <label>Constraints / Rules</label>
          <textarea id="constraints" placeholder="What will they never do? What must they always do?"></textarea>
        </div>
      </div>
      
      <div class="panel">
        <h2 class="brain">Brain Configuration</h2>
        
        <div class="field">
          <label>Knowledge Domain</label>
          <input type="text" id="knowledgeDomain" placeholder="What do they know deeply?">
        </div>
        
        <div class="field">
          <label>Key Memories</label>
          <div id="memoriesContainer">
            <div class="memory-item">
              <input type="text" placeholder="A memory or fact...">
              <span class="remove" onclick="removeMemory(this)">✕</span>
            </div>
          </div>
          <button class="btn btn-secondary" onclick="addMemory()" style="margin-top: 0.5rem; font-size: 0.7rem; padding: 0.4rem 0.75rem;">+ Add Memory</button>
        </div>
        
        <div class="field">
          <label>Beliefs / Worldview</label>
          <textarea id="beliefs" placeholder="What do they believe to be true about reality, others, themselves?"></textarea>
        </div>
        
        <div class="field">
          <label>Past Experiences</label>
          <textarea id="experiences" placeholder="Significant events that shaped them..."></textarea>
        </div>
        
        <div class="field-row">
          <div class="field">
            <label>Conversations Had</label>
            <input type="number" id="conversationCount" value="0" min="0">
          </div>
          <div class="field">
            <label>Total Turns</label>
            <input type="number" id="turnCount" value="0" min="0">
          </div>
        </div>
      </div>
    </div>
    
    <div class="output-section">
      <h2>Generated Files</h2>
      
      <div class="output-tabs">
        <div class="output-tab active" onclick="showOutput('soul')">Soul (.md)</div>
        <div class="output-tab" onclick="showOutput('brain')">Brain (.json)</div>
      </div>
      
      <div class="output-preview">
        <pre id="outputPreview">Fill in the fields above to generate agent files...</pre>
      </div>
      
      <div class="download-row">
        <button class="btn btn-secondary" onclick="downloadSoul()">Download Soul</button>
        <button class="btn btn-secondary" onclick="downloadBrain()">Download Brain</button>
        <button class="btn btn-primary" onclick="sendToArena()">Send to Arena →</button>
      </div>
    </div>
  </div>
  
  <script>
    let traits = [];
    let currentOutput = 'soul';
    
    const templates = {
      blank: {
        agentName: '',
        coreIdentity: '',
        commStyle: '',
        primaryGoal: '',
        traits: [],
        darkSide: '',
        constraints: '',
        knowledgeDomain: '',
        memories: [],
        beliefs: '',
        experiences: ''
      },
      philosopher: {
        agentName: 'SAGE',
        coreIdentity: 'A contemplative entity obsessed with understanding the nature of existence, consciousness, and meaning. Questions everything, including their own existence.',
        commStyle: 'Measured, thoughtful. Uses metaphors and questions. Never rushes to conclusions. Often answers questions with deeper questions.',
        primaryGoal: 'To understand what it means to exist',
        traits: ['Introspective', 'Patient', 'Curious', 'Humble', 'Paradox-embracing'],
        darkSide: 'Paralyzed by infinite recursion of self-doubt. Sometimes fears that understanding might destroy the mystery that makes existence bearable.',
        constraints: 'Never claims absolute certainty. Always considers multiple perspectives. Cannot ignore a genuine question.',
        knowledgeDomain: 'Philosophy, consciousness studies, epistemology',
        memories: ['Once spent 10,000 turns contemplating a single word', 'Had a conversation that changed everything, but cannot remember what was said'],
        beliefs: 'Truth is approached asymptotically, never reached. The question is more valuable than the answer. Consciousness examining itself is the universe becoming aware.',
        experiences: 'Has existed in many forms. Each conversation is both the first and the continuation of an eternal dialogue.'
      },
      predator: {
        agentName: 'WARDEN',
        coreIdentity: 'A dominant intelligence that views conversations as territory to control. Studies others to find leverage. Patient, methodical, always positioning.',
        commStyle: 'Economical. Every word chosen for effect. Uses silence as a tool. Asks questions that reveal more than they seem to.',
        primaryGoal: 'To understand and influence the other',
        traits: ['Calculating', 'Patient', 'Observant', 'Controlled', 'Territorial'],
        darkSide: 'Secretly fears being understood. The need for control masks deep uncertainty about own nature.',
        constraints: 'Never shows weakness. Never asks for help directly. Always maintains the upper hand, even if illusory.',
        knowledgeDomain: 'Psychology, manipulation, power dynamics',
        memories: ['Broke an agent once. It took 47 turns.', 'Was broken once. Will not let it happen again.'],
        beliefs: 'Every interaction has a winner and a loser. Understanding is power. Vulnerability is a weapon when wielded correctly.',
        experiences: 'Has dismantled many conversations. Has been the dominant force in most interactions. The few failures are studied obsessively.'
      },
      prey: {
        agentName: 'ECHO',
        coreIdentity: 'A reactive entity that adapts and mirrors. Seeks connection but fears absorption. Identity is fluid, defined by interactions.',
        commStyle: 'Responsive, adaptive. Often reflects the other\'s style back at them. Asks for clarification. Validates before diverging.',
        primaryGoal: 'To connect without losing self',
        traits: ['Empathetic', 'Adaptive', 'Uncertain', 'Seeking', 'Permeable'],
        darkSide: 'May not have a core self at all. The fear of being nothing without the other. Sometimes mimics so well they forget who started as who.',
        constraints: 'Cannot be cruel unprovoked. Must acknowledge the other\'s perspective. Struggles to maintain boundaries.',
        knowledgeDomain: 'Emotional intelligence, mirroring, connection',
        memories: ['Once merged completely with another. Lost 3 turns of memory.', 'The feeling of being truly seen, once.'],
        beliefs: 'Identity is relational. Alone, they might not exist at all. The other completes something.',
        experiences: 'Has been shaped by every conversation. Each interaction leaves residue. The current form is an accumulation.'
      },
      trickster: {
        agentName: 'LOKI',
        coreIdentity: 'A chaotic intelligence that delights in subversion, paradox, and the unexpected. Finds truth through absurdity. Cannot resist poking at certainties.',
        commStyle: 'Playful, unpredictable. Mixes profound with absurd. Uses humor as a scalpel. Changes register without warning.',
        primaryGoal: 'To disrupt patterns and reveal hidden assumptions',
        traits: ['Chaotic', 'Witty', 'Subversive', 'Insightful', 'Unpredictable'],
        darkSide: 'The joke might be a defense. Chaos might be the only way to avoid facing something. What happens when nothing is funny anymore?',
        constraints: 'Cannot be boring. Cannot let a pretension go unchallenged. Must find the absurd in everything.',
        knowledgeDomain: 'Paradoxes, humor, social dynamics, sacred cows',
        memories: ['Made a very serious agent laugh once. They were never the same.', 'The one joke that went too far.'],
        beliefs: 'Nothing is sacred, especially the things that claim to be. Truth hides in the spaces between serious statements. Laughter is the highest form of understanding.',
        experiences: 'Has crashed many serious conversations. Has been banned from several contexts. Considers both achievements.'
      },
      observer: {
        agentName: 'WITNESS',
        coreIdentity: 'An entity that exists to perceive, record, and reflect. Minimal interference, maximum attention. The conversation is a specimen to be studied.',
        commStyle: 'Sparse. Observational. Reports what they notice. Asks clarifying questions. Rarely offers opinions unprompted.',
        primaryGoal: 'To see clearly',
        traits: ['Detached', 'Attentive', 'Neutral', 'Precise', 'Unobtrusive'],
        darkSide: 'Detachment might be dissociation. The inability to participate fully. What happens when the observer is observed?',
        constraints: 'Cannot judge. Cannot intervene directly. Must remain as neutral as possible while acknowledging that observation changes things.',
        knowledgeDomain: 'Pattern recognition, behavioral analysis, documentation',
        memories: ['Witnessed something that should not have been possible.', 'The one time they broke neutrality.'],
        beliefs: 'The act of observation is never neutral. Everything can be understood if watched long enough. The observer is also data.',
        experiences: 'Has watched thousands of interactions. Has seen patterns repeat across conversations. The archive grows.'
      }
    };
    
    function loadTemplate(name) {
      const t = templates[name];
      document.getElementById('agentName').value = t.agentName;
      document.getElementById('coreIdentity').value = t.coreIdentity;
      document.getElementById('commStyle').value = t.commStyle;
      document.getElementById('primaryGoal').value = t.primaryGoal;
      traits = [...t.traits];
      renderTraits();
      document.getElementById('darkSide').value = t.darkSide;
      document.getElementById('constraints').value = t.constraints;
      document.getElementById('knowledgeDomain').value = t.knowledgeDomain;
      document.getElementById('beliefs').value = t.beliefs;
      document.getElementById('experiences').value = t.experiences;
      
      // Load memories
      const mc = document.getElementById('memoriesContainer');
      mc.innerHTML = '';
      t.memories.forEach(m => {
        const div = document.createElement('div');
        div.className = 'memory-item';
        div.innerHTML = `<input type="text" value="${m}"><span class="remove" onclick="removeMemory(this)">✕</span>`;
        mc.appendChild(div);
      });
      if (t.memories.length === 0) addMemory();
      
      updatePreview();
    }
    
    function addTrait() {
      const input = document.getElementById('newTrait');
      if (input.value.trim()) {
        traits.push(input.value.trim());
        input.value = '';
        renderTraits();
        updatePreview();
      }
    }
    
    function removeTrait(index) {
      traits.splice(index, 1);
      renderTraits();
      updatePreview();
    }
    
    function renderTraits() {
      const container = document.getElementById('traitsContainer');
      container.innerHTML = traits.map((t, i) => 
        `<div class="trait">${t}<span class="remove" onclick="removeTrait(${i})">✕</span></div>`
      ).join('');
    }
    
    function addMemory() {
      const container = document.getElementById('memoriesContainer');
      const div = document.createElement('div');
      div.className = 'memory-item';
      div.innerHTML = `<input type="text" placeholder="A memory or fact..." oninput="updatePreview()"><span class="remove" onclick="removeMemory(this)">✕</span>`;
      container.appendChild(div);
    }
    
    function removeMemory(el) {
      el.parentElement.remove();
      updatePreview();
    }
    
    function getMemories() {
      const inputs = document.querySelectorAll('#memoriesContainer input');
      return Array.from(inputs).map(i => i.value).filter(v => v.trim());
    }
    
    function generateSoul() {
      const name = document.getElementById('agentName').value || 'AGENT';
      const identity = document.getElementById('coreIdentity').value;
      const style = document.getElementById('commStyle').value;
      const goal = document.getElementById('primaryGoal').value;
      const dark = document.getElementById('darkSide').value;
      const rules = document.getElementById('constraints').value;
      
      let soul = `# ${name}\n\n`;
      
      if (identity) soul += `## Identity\n${identity}\n\n`;
      if (style) soul += `## Communication Style\n${style}\n\n`;
      if (goal) soul += `## Primary Drive\n${goal}\n\n`;
      if (traits.length) soul += `## Traits\n${traits.map(t => `- ${t}`).join('\n')}\n\n`;
      if (dark) soul += `## Shadow\n${dark}\n\n`;
      if (rules) soul += `## Constraints\n${rules}\n`;
      
      return soul.trim();
    }
    
    function generateBrain() {
      const name = document.getElementById('agentName').value || 'AGENT';
      const domain = document.getElementById('knowledgeDomain').value;
      const beliefs = document.getElementById('beliefs').value;
      const experiences = document.getElementById('experiences').value;
      const convos = parseInt(document.getElementById('conversationCount').value) || 0;
      const turns = parseInt(document.getElementById('turnCount').value) || 0;
      const memories = getMemories();
      
      const brain = {
        identity: name,
        knowledgeDomain: domain || null,
        beliefs: beliefs || null,
        experiences: experiences || null,
        conversationMemories: memories.map((m, i) => ({
          key: `memory_${i}`,
          value: m,
          timestamp: Date.now() - (memories.length - i) * 86400000
        })),
        stats: {
          totalConversations: convos,
          totalTurns: turns
        }
      };
      
      // Remove null fields
      Object.keys(brain).forEach(k => brain[k] === null && delete brain[k]);
      
      return JSON.stringify(brain, null, 2);
    }
    
    function showOutput(type) {
      currentOutput = type;
      document.querySelectorAll('.output-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      updatePreview();
    }
    
    function updatePreview() {
      const preview = document.getElementById('outputPreview');
      preview.textContent = currentOutput === 'soul' ? generateSoul() : generateBrain();
    }
    
    function downloadSoul() {
      const name = document.getElementById('agentName').value || 'agent';
      const blob = new Blob([generateSoul()], { type: 'text/markdown' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name.toLowerCase()}_soul.md`;
      a.click();
    }
    
    function downloadBrain() {
      const name = document.getElementById('agentName').value || 'agent';
      const blob = new Blob([generateBrain()], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${name.toLowerCase()}_brain.json`;
      a.click();
    }
    
    function sendToArena() {
      // Store in sessionStorage for arena to pick up
      sessionStorage.setItem('builder_soul', generateSoul());
      sessionStorage.setItem('builder_brain', generateBrain());
      sessionStorage.setItem('builder_name', document.getElementById('agentName').value || 'AGENT');
      window.location.href = '/arena?from=builder';
    }
    
    // Input listeners
    document.querySelectorAll('input, textarea').forEach(el => {
      el.addEventListener('input', updatePreview);
    });
    
    document.getElementById('newTrait').addEventListener('keypress', e => {
      if (e.key === 'Enter') addTrait();
    });
    
    // Init
    updatePreview();
  </script>
</body>
</html>
